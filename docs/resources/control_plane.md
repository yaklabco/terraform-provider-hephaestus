---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "hephaestus_control_plane Resource - hephaestus"
subcategory: ""
description: |-
  Initializes the first control plane node of a Kubernetes cluster using kubeadm init
  and deploys kube-vip for high availability.
  This resource must reference a hephaestus_node resource that has been prepared with the
  control_plane role.
  The resource outputs join material (token, CA hash, certificate key) that is used by
  hephaestus_control_plane_member and hephaestus_worker resources to join the cluster.
  Example Usage
  
  resource "hephaestus_node" "cp1" {
    name = "k8s-cp-1"
    ip   = "10.0.0.201"
    role = "control_plane"
  }
  
  resource "hephaestus_control_plane" "primary" {
    node_id           = hephaestus_node.cp1.id
    node_ip           = hephaestus_node.cp1.ip
    control_plane_vip = "10.0.0.200"
    pod_cidr          = "10.244.0.0/16"
    service_cidr      = "10.96.0.0/12"
  }
  
  output "kubeconfig" {
    value     = hephaestus_control_plane.primary.kubeconfig
    sensitive = true
  }
---

# hephaestus_control_plane (Resource)

Initializes the first control plane node of a Kubernetes cluster using kubeadm init
and deploys kube-vip for high availability.

This resource must reference a `hephaestus_node` resource that has been prepared with the 
`control_plane` role.

The resource outputs join material (token, CA hash, certificate key) that is used by 
`hephaestus_control_plane_member` and `hephaestus_worker` resources to join the cluster.

## Example Usage

```hcl
resource "hephaestus_node" "cp1" {
  name = "k8s-cp-1"
  ip   = "10.0.0.201"
  role = "control_plane"
}

resource "hephaestus_control_plane" "primary" {
  node_id           = hephaestus_node.cp1.id
  node_ip           = hephaestus_node.cp1.ip
  control_plane_vip = "10.0.0.200"
  pod_cidr          = "10.244.0.0/16"
  service_cidr      = "10.96.0.0/12"
}

output "kubeconfig" {
  value     = hephaestus_control_plane.primary.kubeconfig
  sensitive = true
}
```



<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `control_plane_vip` (String) Virtual IP for high availability control plane access
- `node_id` (String) ID of the hephaestus_node resource for the first control plane
- `node_ip` (String) IP address of the first control plane node

### Optional

- `kubevip_interface` (String) Network interface for kube-vip. If not set, auto-detected from default route.
- `kubevip_version` (String) kube-vip version. Default: `v0.8.0`
- `pod_cidr` (String) Pod network CIDR. Default: `10.244.0.0/16`
- `service_cidr` (String) Service network CIDR. Default: `10.96.0.0/12`

### Read-Only

- `api_endpoint` (String) Kubernetes API endpoint (VIP:6443)
- `ca_cert_hash` (String, Sensitive) CA certificate hash for secure joining
- `certificate_key` (String, Sensitive) Certificate key for control plane joins
- `id` (String) Cluster identifier
- `join_token` (String, Sensitive) Bootstrap token for joining nodes (expires after 24h)
- `kubeconfig` (String, Sensitive) Admin kubeconfig for cluster access
- `token_expiry` (String) Token expiration timestamp (RFC3339)
